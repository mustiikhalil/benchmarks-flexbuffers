# [WIP] Benchmarks for FlexBuffers Swift

## ⚠️⚠️ WIP

- The vision for the future is to add some type of Codable protocol to make it easier for users to write flexbuffers

## Introduction

The following Repository compares the benchmarks between the native swift JSON encoder and decode 
compared to the FlexBuffers implementation. The vision of flexbuffers API within swift is to be something
similar to this:

```swift
struct Position: FlexBufferCodable { let x, y, z: Double }

let a = Position(x: 3.0, y: 4.0, z: 5.0)

let buffer: ByteBuffer = FlexBufferCoder().encode(a)

let pos = FlexBufferCoder().decode(buffer, as: Position.self)
```

## Size comparison

Within the resources folder you would find the binaries and jsons

| Keys                             | Twitter | Canada |
| -------------------------------- | :-----: | -----: |
| JSON                             |  617K   |   2.1M |
| FlexBuffer shared key            |  136K   |   1.3M |
| FlexBuffer shared key and string |   93K   |   1.3M |


## Notes

- Canada test is using a typedvector (swift native arrays) to achive that performance

## Readable Benchmarks

`swift package benchmark --grouping metric --time-units nanoseconds`

```
Host 'Mustiis-MacBook-Pro.local' with 12 'arm64' processors with 24 GB memory, running:
Darwin Kernel Version 25.1.0: Mon Oct 20 19:34:05 PDT 2025; root:xnu-12377.41.6~2/RELEASE_ARM64_T6041

Throughput (# / s)
╒════════════════════════════════════════════════════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Test                                                                   │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞════════════════════════════════════════════════════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Benchmarks:canada-decode-JSON (K)                                      │        59 │        57 │        56 │        55 │        54 │        54 │        54 │       169 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeys (M)               │       632 │       586 │       534 │       534 │       522 │       500 │        45 │    950883 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeysAndStrings (M)     │       632 │       586 │       545 │       534 │       522 │       500 │        20 │    945416 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-JSON (K)                                      │        35 │        34 │        34 │        34 │        33 │        33 │        33 │       102 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeys (K)               │       330 │       306 │       304 │       303 │       299 │       291 │       287 │       913 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeysAndStrings (K)     │       338 │       309 │       305 │       302 │       298 │       292 │       282 │       916 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-JSON (K)                                     │       683 │       630 │       624 │       614 │       610 │       599 │       580 │      1868 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeys (M)              │      2183 │      1716 │      1713 │      1601 │      1601 │      1500 │        49 │   1514625 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeysAndStrings (M)    │      2183 │      1716 │      1713 │      1601 │      1601 │      1500 │        47 │   1606407 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-JSON (K)                                     │      1467 │      1373 │      1354 │      1337 │      1326 │      1295 │      1170 │      4060 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeys (K)              │      3334 │      3107 │      3071 │      3013 │      2977 │      2899 │      2494 │      9156 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeysAndStrings (K)    │      1609 │      1503 │      1487 │      1474 │      1462 │      1433 │      1356 │      4460 │
╘════════════════════════════════════════════════════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Time (total CPU)
╒════════════════════════════════════════════════════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Test                                                                   │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞════════════════════════════════════════════════════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Benchmarks:canada-decode-JSON (ns) *                                   │     16899 │     17498 │     17711 │     18170 │     18481 │     18596 │     18677 │       169 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeys (ns) *            │         2 │         2 │         2 │         2 │         2 │         3 │        23 │    950883 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeysAndStrings (ns) *  │         2 │         2 │         2 │         2 │         2 │         3 │        71 │    945416 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-JSON (ns) *                                   │     28666 │     29409 │     29639 │     29786 │     29917 │     30245 │     30635 │       102 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeys (ns) *            │      3035 │      3269 │      3285 │      3305 │      3346 │      3439 │      3484 │       913 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeysAndStrings (ns) *  │      2958 │      3234 │      3281 │      3312 │      3355 │      3424 │      3552 │       916 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-JSON (ns) *                                  │      1464 │      1589 │      1604 │      1629 │      1640 │      1671 │      1722 │      1868 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeys (ns) *           │         1 │         1 │         1 │         1 │         1 │         1 │        21 │   1514625 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeysAndStrings (ns) * │         1 │         1 │         1 │         1 │         1 │         1 │        22 │   1606407 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-JSON (ns) *                                  │       682 │       729 │       739 │       749 │       755 │       773 │       841 │      4060 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeys (ns) *           │       300 │       323 │       326 │       333 │       337 │       345 │       401 │      9156 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeysAndStrings (ns) * │       622 │       666 │       673 │       679 │       685 │       698 │       739 │      4460 │
╘════════════════════════════════════════════════════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛
```
