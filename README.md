# [WIP] Benchmarks for FlexBuffers Swift

## ⚠️⚠️ WIP

- Currently Decoding Flexbuffers doesnt work
- Currently only the normal way of writing flexbuffers is supported
- The vision for the future is to add some type of Codable protocol to make it easier for users to write flexbuffers
- Havent tested the written flexbuffers Binaries 

## Introduction

The following Repository compares the benchmarks between the native swift JSON encoder and decode 
compared to the FlexBuffers implementation. The vision of flexbuffers API within swift is to be something
similar to this:

```swift
struct Position: FlexBufferCodable { let x, y, z: Double }

let a = Position(x: 3.0, y: 4.0, z: 5.0)

let buffer: ByteBuffer = FlexBufferCoder().encode(a)

let pos = FlexBufferCoder().decode(buffer, as: Position.self)
```

## Readable Benchmarks

```
==============================================================================================================
Baseline 'Current_run'
==============================================================================================================

Host 'Mustiis-Macbook-Pro.local' with 10 'arm64' processors with 16 GB memory, running:
Darwin Kernel Version 24.4.0: Sat Feb 15 22:50:54 PST 2025; root:xnu-11417.100.533.501.4~3/RELEASE_ARM64_T6000

==========
Benchmarks
==========

Canada-decodeFromJSON
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │        29 │        29 │        29 │        29 │        29 │        28 │        28 │        87 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (μs) *   │        35 │        35 │        35 │        35 │        35 │        35 │        35 │        87 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Canada-encodeToJSON
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │        14 │        14 │        14 │        14 │        14 │        14 │        14 │        42 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (μs) *   │        72 │        72 │        72 │        72 │        72 │        73 │        73 │        42 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Canada-manual-encodeToFlexbufferSharedKeys
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │       184 │       182 │       182 │       181 │       180 │       174 │       164 │       544 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (ns) *   │      5446 │      5489 │      5505 │      5530 │      5562 │      5743 │      5841 │       544 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Canada-manual-encodeToFlexbufferSharedKeysAndStrings
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │       111 │       110 │       109 │       109 │       109 │       107 │       107 │       329 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (ns) *   │      8977 │      9126 │      9150 │      9167 │      9216 │      9306 │      9328 │       329 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Twitter-decodeFromJSON
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │       358 │       356 │       356 │       355 │       353 │       331 │       298 │      1063 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (ns) *   │      2797 │      2808 │      2812 │      2818 │      2834 │      3023 │      3355 │      1063 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Twitter-encodeToJSON
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │       701 │       698 │       697 │       696 │       693 │       680 │       655 │      2084 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (ns) *   │      1426 │      1434 │      1436 │      1439 │      1445 │      1471 │      1527 │      2084 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Twitter-manual-encodeToFlexbufferSharedKeys
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │      1557 │      1551 │      1549 │      1544 │      1536 │      1433 │       778 │      4606 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (ns) *   │       643 │       646 │       647 │       649 │       652 │       697 │      1214 │      4606 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Twitter-manual-encodeToFlexbufferSharedKeysAndStrings
╒═══════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Metric                    │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞═══════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Throughput (# / s) (K)    │       736 │       734 │       733 │       731 │       727 │       704 │       378 │      2188 │
├───────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Time (total CPU) (ns) *   │      1359 │      1364 │      1366 │      1369 │      1376 │      1422 │      2131 │      2188 │
╘═══════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛
```
