# [WIP] Benchmarks for FlexBuffers Swift

## ⚠️⚠️ WIP

- The vision for the future is to add some type of Codable protocol to make it easier for users to write flexbuffers

## Introduction

The following Repository compares the benchmarks between the native swift JSON encoder and decode 
compared to the FlexBuffers implementation. The vision of flexbuffers API within swift is to be something
similar to this:

```swift
struct Position: FlexBufferCodable { let x, y, z: Double }

let a = Position(x: 3.0, y: 4.0, z: 5.0)

let buffer: ByteBuffer = FlexBufferCoder().encode(a)

let pos = FlexBufferCoder().decode(buffer, as: Position.self)
```

## Size comparison

Within the resources folder you would find the binaries and jsons

| Keys                             | Twitter | Canada |
| -------------------------------- | :-----: | -----: |
| JSON                             |  617K   |   2.1M |
| FlexBuffer shared key            |  136K   |   1.3M |
| FlexBuffer shared key and string |   93K   |   1.3M |


## Notes

- Canada test is using a typedvector (swift native arrays) to achive that performance

## Readable Benchmarks

`swift package benchmark --grouping metric --time-units nanoseconds`

```
Host 'Mustiis-MacBook-Pro.local' with 12 'arm64' processors with 24 GB memory, running:
Darwin Kernel Version 25.1.0: Mon Oct 20 19:34:05 PDT 2025; root:xnu-12377.41.6~2/RELEASE_ARM64_T6041

Throughput (# / s)
╒════════════════════════════════════════════════════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Test                                                                   │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞════════════════════════════════════════════════════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Benchmarks:canada-decode-Flatbuffer (K)                                │     10536 │      9935 │      9415 │      9343 │      9015 │      8575 │      4384 │     28258 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-FlatbufferMutable (K)                         │     10753 │     10119 │      9599 │      9527 │      9311 │      8935 │      7084 │     28878 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-JSON (K)                                      │        67 │        64 │        64 │        63 │        62 │        62 │        59 │       191 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeys (M)               │       632 │       572 │       534 │       522 │       511 │       490 │        42 │    947893 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeysAndStrings (M)     │       632 │       585 │       534 │       522 │       522 │       500 │        16 │    937982 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-Flatbuffer (K)                                │      4225 │      3931 │      3853 │      3763 │      3729 │      3623 │      3202 │     11491 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-JSON (K)                                      │        35 │        35 │        34 │        34 │        34 │        34 │        33 │       104 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeys (K)               │       328 │       300 │       298 │       297 │       294 │       289 │       273 │       897 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeysAndStrings (K)     │       326 │       300 │       296 │       292 │       288 │       282 │       270 │       887 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-Flatbuffer (K)                               │      4472 │      4131 │      4043 │      3989 │      3905 │      3685 │      2878 │     12061 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-JSON (K)                                     │       678 │       623 │       618 │       611 │       606 │       595 │       555 │      1852 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeys (M)              │      2183 │      1716 │      1713 │      1601 │      1601 │      1500 │        36 │   1556389 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeysAndStrings (M)    │      2183 │      1716 │      1601 │      1601 │      1601 │      1500 │        47 │   1567881 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-Flatbuffer (M)                               │        18 │        16 │        16 │        16 │        16 │        15 │        10 │     47102 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-JSON (K)                                     │      1485 │      1375 │      1352 │      1330 │      1294 │      1242 │      1188 │      4038 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeys (K)              │      3328 │      3081 │      3051 │      2995 │      2963 │      2895 │      2580 │      9093 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeysAndStrings (K)    │      1607 │      1493 │      1476 │      1464 │      1450 │      1419 │      1307 │      4429 │
╘════════════════════════════════════════════════════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛

Time (total CPU)
╒════════════════════════════════════════════════════════════════════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╤═══════════╕
│ Test                                                                   │        p0 │       p25 │       p50 │       p75 │       p90 │       p99 │      p100 │   Samples │
╞════════════════════════════════════════════════════════════════════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╪═══════════╡
│ Benchmarks:canada-decode-Flatbuffer (ns) *                             │        95 │       101 │       107 │       108 │       112 │       117 │       215 │     28258 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-FlatbufferMutable (ns) *                      │        93 │        99 │       105 │       106 │       108 │       112 │       133 │     28878 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-JSON (ns) *                                   │     15028 │     15598 │     15753 │     15901 │     16048 │     16261 │     16837 │       191 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeys (ns) *            │         2 │         2 │         2 │         2 │         2 │         3 │        20 │    947893 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-decode-manual-FlexbufferSharedKeysAndStrings (ns) *  │         2 │         2 │         2 │         2 │         2 │         3 │        49 │    937982 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-Flatbuffer (ns) *                             │       237 │       255 │       260 │       266 │       269 │       276 │       313 │     11491 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-JSON (ns) *                                   │     28214 │     28934 │     29098 │     29213 │     29295 │     29540 │     30010 │       104 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeys (ns) *            │      3045 │      3332 │      3353 │      3373 │      3404 │      3465 │      3669 │       897 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:canada-encode-manual-FlexbufferSharedKeysAndStrings (ns) *  │      3071 │      3330 │      3377 │      3428 │      3475 │      3547 │      3707 │       887 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-Flatbuffer (ns) *                            │       224 │       243 │       248 │       251 │       257 │       272 │       348 │     12061 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-JSON (ns) *                                  │      1475 │      1606 │      1618 │      1637 │      1651 │      1682 │      1804 │      1852 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeys (ns) *           │         1 │         1 │         1 │         1 │         1 │         1 │        18 │   1556389 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-decode-manual-FlexbufferSharedKeysAndStrings (ns) * │         1 │         1 │         1 │         1 │         1 │         1 │        42 │   1567881 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-Flatbuffer (ns) *                            │        56 │        63 │        63 │        64 │        64 │        68 │        94 │     47102 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-JSON (ns) *                                  │       674 │       728 │       740 │       753 │       773 │       806 │       840 │      4038 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeys (ns) *           │       301 │       325 │       328 │       335 │       338 │       346 │       389 │      9093 │
├────────────────────────────────────────────────────────────────────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ Benchmarks:twitter-encode-manual-FlexbufferSharedKeysAndStrings (ns) * │       623 │       671 │       678 │       684 │       690 │       706 │       765 │      4429 │
╘════════════════════════════════════════════════════════════════════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╧═══════════╛
```
